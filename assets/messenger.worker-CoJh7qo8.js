var v;function k(e){return{lang:v?.lang,message:e?.message,abortEarly:v?.abortEarly,abortPipeEarly:v?.abortPipeEarly}}var j;function M(e){return j?.get(e)}var O;function x(e){return O?.get(e)}var T;function C(e,r){return T?.get(e)?.get(r)}function N(e){const r=typeof e;return r==="string"?`"${e}"`:r==="number"||r==="bigint"||r==="boolean"?`${e}`:r==="object"||r==="function"?(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null":r}function f(e,r,t,s,n){const u=n&&"input"in n?n.input:t.value,i=n?.expected??e.expects??null,o=n?.received??N(u),a={kind:e.kind,type:e.type,input:u,expected:i,received:o,message:`Invalid ${r}: ${i?`Expected ${i} but r`:"R"}eceived ${o}`,requirement:e.requirement,path:n?.path,issues:n?.issues,lang:s.lang,abortEarly:s.abortEarly,abortPipeEarly:s.abortPipeEarly},c=e.kind==="schema",l=n?.message??e.message??C(e.reference,a.lang)??(c?x(a.lang):null)??s.message??M(a.lang);l!==void 0&&(a.message=typeof l=="function"?l(a):l),c&&(t.typed=!1),t.issues?t.issues.push(a):t.issues=[a]}function p(e){return{version:1,vendor:"valibot",validate(r){return e["~run"]({value:r},k())}}}function A(e,r,t){return typeof e.fallback=="function"?e.fallback(r,t):e.fallback}function q(e,r,t){return typeof e.default=="function"?e.default(r,t):e.default}function P(){return{kind:"schema",type:"any",reference:P,expects:"any",async:!1,get"~standard"(){return p(this)},"~run"(e){return e.typed=!0,e}}}function E(e,r){return{kind:"schema",type:"array",reference:E,expects:"Array",async:!1,item:e,message:r,get"~standard"(){return p(this)},"~run"(t,s){const n=t.value;if(Array.isArray(n)){t.typed=!0,t.value=[];for(let u=0;u<n.length;u++){const i=n[u],o=this.item["~run"]({value:i},s);if(o.issues){const a={type:"array",origin:"value",input:n,key:u,value:i};for(const c of o.issues)c.path?c.path.unshift(a):c.path=[a],t.issues?.push(c);if(t.issues||(t.issues=o.issues),s.abortEarly){t.typed=!1;break}}o.typed||(t.typed=!1),t.value.push(o.value)}}else f(this,"type",t,s);return t}}}function _(e){return{kind:"schema",type:"boolean",reference:_,expects:"boolean",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="boolean"?r.typed=!0:f(this,"type",r,t),r}}}function d(e){return{kind:"schema",type:"number",reference:d,expects:"number",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="number"&&!isNaN(r.value)?r.typed=!0:f(this,"type",r,t),r}}}function y(e,r){return{kind:"schema",type:"object",reference:y,expects:"Object",async:!1,entries:e,message:r,get"~standard"(){return p(this)},"~run"(t,s){const n=t.value;if(n&&typeof n=="object"){t.typed=!0,t.value={};for(const u in this.entries){const i=this.entries[u];if(u in n||(i.type==="exact_optional"||i.type==="optional"||i.type==="nullish")&&i.default!==void 0){const o=u in n?n[u]:q(i),a=i["~run"]({value:o},s);if(a.issues){const c={type:"object",origin:"value",input:n,key:u,value:o};for(const l of a.issues)l.path?l.path.unshift(c):l.path=[c],t.issues?.push(l);if(t.issues||(t.issues=a.issues),s.abortEarly){t.typed=!1;break}}a.typed||(t.typed=!1),t.value[u]=a.value}else if(i.fallback!==void 0)t.value[u]=A(i);else if(i.type!=="exact_optional"&&i.type!=="optional"&&i.type!=="nullish"&&(f(this,"key",t,s,{input:void 0,expected:`"${u}"`,path:[{type:"object",origin:"key",input:n,key:u,value:n[u]}]}),s.abortEarly))break}}else f(this,"type",t,s);return t}}}function $(e){return{kind:"schema",type:"string",reference:$,expects:"string",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="string"?r.typed=!0:f(this,"type",r,t),r}}}function h(){return{kind:"schema",type:"unknown",reference:h,expects:"unknown",async:!1,get"~standard"(){return p(this)},"~run"(e){return e.typed=!0,e}}}function G(e,r,t){const s=e["~run"]({value:r},k(t));return{typed:s.typed,success:!s.issues,output:s.value,issues:s.issues}}function b(e,r){return{validate:t=>G(e,t).success,create:r}}function D(e,r,t){const s=r.reduce((n,u)=>n?.[u],e);if(typeof s!="function")throw new Error(`Topics did not resolve to a function: [${r.join(",")}]`);return s(...t)}var g="RPC_PROXY_REQUEST",F=y({[g]:d(),payload:h()}),I=b(F,(e,r)=>({[g]:e,payload:r})),m="RPC_PROXY_RESPONSE",Q=b(y({[m]:d(),payload:h()}),(e,r)=>({[m]:e[g],payload:r})),R="RPC_PROXY_ERROR",U=b(y({[R]:d(),error:h()}),(e,r)=>({[R]:e[g],error:r})),S="RPC_PROXY_RPC_REQUEST",X=b(y({[S]:_(),topics:E($()),args:E(P())}),(e,r)=>({[S]:!0,topics:e,args:r})),Y="RPC-TRANSFER";function H(e){return!!e&&typeof e=="object"&&Y in e}function L(e){const r=[],t=n=>{if(H(n))return r.push(n),n;if(Array.isArray(n))return n.map(t);if(n&&typeof n=="object"&&n.constructor===Object){const u={};for(const i in n)u[i]=t(n[i]);return u}return n};return{args:e.map(t),transferables:r}}function V(e){return typeof e=="object"&&typeof e?.postMessage=="function"&&typeof e?.closed=="boolean"}function W(e){return V(e)?(r,t)=>e.postMessage(r,"*",t):(r,t)=>e.postMessage(r,t)}function z(e,r,t={}){const s=W(e);e.addEventListener("message",async n=>{const u=n.data;if(I.validate(u))try{const i=await r(u),{args:[o],transferables:a}=L([i]);s(Q.create(u,o),a)}catch(i){s(U.create(u,i))}},t),"start"in e&&e.start?.()}function B(e,{to:r=self,signal:t}={}){z(r,s=>{if(X.validate(s.payload))try{const{topics:n,args:u}=s.payload;return D(e,n,u)}catch(n){console.error("Error while processing rpc request:",n,s.payload,e)}},{signal:t})}const w={greet(e){return`Hello, ${e}!`},add(e,r){return e+r},multiply(e,r){return e*r},async fetchData(e){return await new Promise(r=>setTimeout(r,500)),{url:e,timestamp:Date.now(),data:"Fetched data from worker"}},math:{square(e){return e*e},factorial(e){return e<=1?1:e*w.math.factorial(e-1)}},slowOperation(e){return new Promise(r=>{setTimeout(()=>r(`Completed after ${e}ms`),e)})}};B(w);
