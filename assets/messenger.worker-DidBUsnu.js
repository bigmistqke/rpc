var Y=Symbol("RPC-HANDLE-MARKER");function Q(e){return!!e&&typeof e=="object"&&Y in e}var A="__rpc_handle_",K=0;function W(){return`${A}${K++}`}var b;function j(e){return{lang:b?.lang,message:e?.message,abortEarly:b?.abortEarly,abortPipeEarly:b?.abortPipeEarly}}var V;function z(e){return V?.get(e)}var B;function J(e){return B?.get(e)}var Z;function ee(e,r){return Z?.get(e)?.get(r)}function re(e){const r=typeof e;return r==="string"?`"${e}"`:r==="number"||r==="bigint"||r==="boolean"?`${e}`:r==="object"||r==="function"?(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null":r}function f(e,r,t,s,n){const u=n&&"input"in n?n.input:t.value,a=n?.expected??e.expects??null,o=n?.received??re(u),i={kind:e.kind,type:e.type,input:u,expected:a,received:o,message:`Invalid ${r}: ${a?`Expected ${a} but r`:"R"}eceived ${o}`,requirement:e.requirement,path:n?.path,issues:n?.issues,lang:s.lang,abortEarly:s.abortEarly,abortPipeEarly:s.abortPipeEarly},c=e.kind==="schema",l=n?.message??e.message??ee(e.reference,i.lang)??(c?J(i.lang):null)??s.message??z(i.lang);l!==void 0&&(i.message=typeof l=="function"?l(i):l),c&&(t.typed=!1),t.issues?t.issues.push(i):t.issues=[i]}function p(e){return{version:1,vendor:"valibot",validate(r){return e["~run"]({value:r},j())}}}function te(e,r,t){return typeof e.fallback=="function"?e.fallback(r,t):e.fallback}function x(e,r,t){return typeof e.default=="function"?e.default(r,t):e.default}function C(){return{kind:"schema",type:"any",reference:C,expects:"any",async:!1,get"~standard"(){return p(this)},"~run"(e){return e.typed=!0,e}}}function g(e,r){return{kind:"schema",type:"array",reference:g,expects:"Array",async:!1,item:e,message:r,get"~standard"(){return p(this)},"~run"(t,s){const n=t.value;if(Array.isArray(n)){t.typed=!0,t.value=[];for(let u=0;u<n.length;u++){const a=n[u],o=this.item["~run"]({value:a},s);if(o.issues){const i={type:"array",origin:"value",input:n,key:u,value:a};for(const c of o.issues)c.path?c.path.unshift(i):c.path=[i],t.issues?.push(c);if(t.issues||(t.issues=o.issues),s.abortEarly){t.typed=!1;break}}o.typed||(t.typed=!1),t.value.push(o.value)}}else f(this,"type",t,s);return t}}}function O(e){return{kind:"schema",type:"boolean",reference:O,expects:"boolean",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="boolean"?r.typed=!0:f(this,"type",r,t),r}}}function h(e){return{kind:"schema",type:"number",reference:h,expects:"number",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="number"&&!isNaN(r.value)?r.typed=!0:f(this,"type",r,t),r}}}function y(e,r){return{kind:"schema",type:"object",reference:y,expects:"Object",async:!1,entries:e,message:r,get"~standard"(){return p(this)},"~run"(t,s){const n=t.value;if(n&&typeof n=="object"){t.typed=!0,t.value={};for(const u in this.entries){const a=this.entries[u];if(u in n||(a.type==="exact_optional"||a.type==="optional"||a.type==="nullish")&&a.default!==void 0){const o=u in n?n[u]:x(a),i=a["~run"]({value:o},s);if(i.issues){const c={type:"object",origin:"value",input:n,key:u,value:o};for(const l of i.issues)l.path?l.path.unshift(c):l.path=[c],t.issues?.push(l);if(t.issues||(t.issues=i.issues),s.abortEarly){t.typed=!1;break}}i.typed||(t.typed=!1),t.value[u]=i.value}else if(a.fallback!==void 0)t.value[u]=te(a);else if(a.type!=="exact_optional"&&a.type!=="optional"&&a.type!=="nullish"&&(f(this,"key",t,s,{input:void 0,expected:`"${u}"`,path:[{type:"object",origin:"key",input:n,key:u,value:n[u]}]}),s.abortEarly))break}}else f(this,"type",t,s);return t}}}function T(e,r){return{kind:"schema",type:"optional",reference:T,expects:`(${e.expects} | undefined)`,async:!1,wrapped:e,default:r,get"~standard"(){return p(this)},"~run"(t,s){return t.value===void 0&&(this.default!==void 0&&(t.value=x(this,t,s)),t.value===void 0)?(t.typed=!0,t):this.wrapped["~run"](t,s)}}}function m(e){return{kind:"schema",type:"string",reference:m,expects:"string",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="string"?r.typed=!0:f(this,"type",r,t),r}}}function E(){return{kind:"schema",type:"unknown",reference:E,expects:"unknown",async:!1,get"~standard"(){return p(this)},"~run"(e){return e.typed=!0,e}}}function ne(e,r,t){const s=e["~run"]({value:r},j(t));return{typed:s.typed,success:!s.issues,output:s.value,issues:s.issues}}function d(e,r){return{validate:t=>ne(e,t).success,create:r}}function P(e,r,t){const s=r.reduce((n,u)=>n?.[u],e);if(typeof s!="function")throw new Error(`Topics did not resolve to a function: [${r.join(",")}]`);return s(...t)}var v="RPC_PROXY_REQUEST",se=y({[v]:h(),payload:E()}),ae=d(se,(e,r)=>({[v]:e,payload:r})),k="RPC_PROXY_RESPONSE",_=d(y({[k]:h(),payload:T(E())}),(e,r)=>({[k]:e[v],payload:r})),$="RPC_PROXY_ERROR",ue=d(y({[$]:h(),error:E()}),(e,r)=>({[$]:e[v],error:r})),w="RPC_PROXY_RPC_REQUEST",ie=d(y({[w]:O(),topics:g(m()),args:g(C())}),(e,r)=>({[w]:!0,topics:e,args:r})),M="RPC_PROXY_HANDLE",oe=d(y({[M]:m()}),e=>({[M]:e})),ce="RPC-TRANSFER";function le(e){return!!e&&typeof e=="object"&&ce in e}function N(e){const r=[],t=n=>{if(le(n))return r.push(n),n;if(Array.isArray(n))return n.map(t);if(n&&typeof n=="object"&&n.constructor===Object){const u={};for(const a in n)u[a]=t(n[a]);return u}return n};return{args:e.map(t),transferables:r}}function pe(e){return typeof e=="object"&&typeof e?.postMessage=="function"&&typeof e?.closed=="boolean"}function fe(e){return pe(e)?(r,t)=>e.postMessage(r,"*",t):(r,t)=>e.postMessage(r,t)}function ye(e,{to:r=self,signal:t}={}){const s=fe(r),n=new Map,u=a=>{if(Q(a)){const o=W();return n.set(o,a.methods),oe.create(o)}return a};r.addEventListener("message",async a=>{const o=a.data;if(ae.validate(o))try{if(ie.validate(o.payload)){const{topics:i,args:c}=o.payload,l=i[0];if(l&&l.startsWith(A)){const R=l,S=n.get(R);if(!S)throw new Error(`Unknown namespace: ${R}`);const L=await P(S,i.slice(1),c),X=u(L),{args:[F],transferables:U}=N([X]);s(_.create(o,F),U);return}const H=await P(e,i,c),I=u(H),{args:[G],transferables:q}=N([I]);s(_.create(o,G),q);return}}catch(i){console.error("Error while processing rpc request:",i,o.payload),s(ue.create(o,i))}},{signal:t}),"start"in r&&r.start?.()}const D={greet(e){return`Hello, ${e}!`},add(e,r){return e+r},multiply(e,r){return e*r},async fetchData(e){return await new Promise(r=>setTimeout(r,500)),{url:e,timestamp:Date.now(),data:"Fetched data from worker"}},math:{square(e){return e*e},factorial(e){return e<=1?1:e*D.math.factorial(e-1)}},slowOperation(e){return new Promise(r=>{setTimeout(()=>r(`Completed after ${e}ms`),e)})}};ye(D);
