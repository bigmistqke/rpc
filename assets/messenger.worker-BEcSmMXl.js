var C=Symbol("RPC-HANDLE-MARKER");function O(e){return!!e&&typeof e=="object"&&C in e}var $="__rpc_handle_",T=0;function H(){return`${$}${T++}`}var b;function w(e){return{lang:b?.lang,message:e?.message,abortEarly:b?.abortEarly,abortPipeEarly:b?.abortPipeEarly}}var D;function q(e){return D?.get(e)}var G;function I(e){return G?.get(e)}var L;function X(e,r){return L?.get(e)?.get(r)}function F(e){const r=typeof e;return r==="string"?`"${e}"`:r==="number"||r==="bigint"||r==="boolean"?`${e}`:r==="object"||r==="function"?(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null":r}function f(e,r,t,s,n){const u=n&&"input"in n?n.input:t.value,a=n?.expected??e.expects??null,o=n?.received??F(u),i={kind:e.kind,type:e.type,input:u,expected:a,received:o,message:`Invalid ${r}: ${a?`Expected ${a} but r`:"R"}eceived ${o}`,requirement:e.requirement,path:n?.path,issues:n?.issues,lang:s.lang,abortEarly:s.abortEarly,abortPipeEarly:s.abortPipeEarly},c=e.kind==="schema",l=n?.message??e.message??X(e.reference,i.lang)??(c?I(i.lang):null)??s.message??q(i.lang);l!==void 0&&(i.message=typeof l=="function"?l(i):l),c&&(t.typed=!1),t.issues?t.issues.push(i):t.issues=[i]}function p(e){return{version:1,vendor:"valibot",validate(r){return e["~run"]({value:r},w())}}}function U(e,r,t){return typeof e.fallback=="function"?e.fallback(r,t):e.fallback}function M(e,r,t){return typeof e.default=="function"?e.default(r,t):e.default}function N(){return{kind:"schema",type:"any",reference:N,expects:"any",async:!1,get"~standard"(){return p(this)},"~run"(e){return e.typed=!0,e}}}function g(e,r){return{kind:"schema",type:"array",reference:g,expects:"Array",async:!1,item:e,message:r,get"~standard"(){return p(this)},"~run"(t,s){const n=t.value;if(Array.isArray(n)){t.typed=!0,t.value=[];for(let u=0;u<n.length;u++){const a=n[u],o=this.item["~run"]({value:a},s);if(o.issues){const i={type:"array",origin:"value",input:n,key:u,value:a};for(const c of o.issues)c.path?c.path.unshift(i):c.path=[i],t.issues?.push(c);if(t.issues||(t.issues=o.issues),s.abortEarly){t.typed=!1;break}}o.typed||(t.typed=!1),t.value.push(o.value)}}else f(this,"type",t,s);return t}}}function A(e){return{kind:"schema",type:"boolean",reference:A,expects:"boolean",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="boolean"?r.typed=!0:f(this,"type",r,t),r}}}function h(e){return{kind:"schema",type:"number",reference:h,expects:"number",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="number"&&!isNaN(r.value)?r.typed=!0:f(this,"type",r,t),r}}}function y(e,r){return{kind:"schema",type:"object",reference:y,expects:"Object",async:!1,entries:e,message:r,get"~standard"(){return p(this)},"~run"(t,s){const n=t.value;if(n&&typeof n=="object"){t.typed=!0,t.value={};for(const u in this.entries){const a=this.entries[u];if(u in n||(a.type==="exact_optional"||a.type==="optional"||a.type==="nullish")&&a.default!==void 0){const o=u in n?n[u]:M(a),i=a["~run"]({value:o},s);if(i.issues){const c={type:"object",origin:"value",input:n,key:u,value:o};for(const l of i.issues)l.path?l.path.unshift(c):l.path=[c],t.issues?.push(l);if(t.issues||(t.issues=i.issues),s.abortEarly){t.typed=!1;break}}i.typed||(t.typed=!1),t.value[u]=i.value}else if(a.fallback!==void 0)t.value[u]=U(a);else if(a.type!=="exact_optional"&&a.type!=="optional"&&a.type!=="nullish"&&(f(this,"key",t,s,{input:void 0,expected:`"${u}"`,path:[{type:"object",origin:"key",input:n,key:u,value:n[u]}]}),s.abortEarly))break}}else f(this,"type",t,s);return t}}}function x(e,r){return{kind:"schema",type:"optional",reference:x,expects:`(${e.expects} | undefined)`,async:!1,wrapped:e,default:r,get"~standard"(){return p(this)},"~run"(t,s){return t.value===void 0&&(this.default!==void 0&&(t.value=M(this,t,s)),t.value===void 0)?(t.typed=!0,t):this.wrapped["~run"](t,s)}}}function m(e){return{kind:"schema",type:"string",reference:m,expects:"string",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="string"?r.typed=!0:f(this,"type",r,t),r}}}function E(){return{kind:"schema",type:"unknown",reference:E,expects:"unknown",async:!1,get"~standard"(){return p(this)},"~run"(e){return e.typed=!0,e}}}function Y(e,r,t){const s=e["~run"]({value:r},w(t));return{typed:s.typed,success:!s.issues,output:s.value,issues:s.issues}}function d(e,r){return{validate:t=>Y(e,t).success,create:r}}var v="RPC_PROXY_REQUEST",Q=y({[v]:h(),payload:E()}),K=d(Q,(e,r)=>({[v]:e,payload:r})),R="RPC_PROXY_RESPONSE",W=d(y({[R]:h(),payload:x(E())}),(e,r)=>({[R]:e[v],payload:r})),S="RPC_PROXY_ERROR",V=d(y({[S]:h(),error:E()}),(e,r)=>({[S]:e[v],error:r})),P="RPC_PROXY_RPC_REQUEST",z=d(y({[P]:A(),topics:g(m()),args:g(N())}),(e,r)=>({[P]:!0,topics:e,args:r})),k="RPC_PROXY_HANDLE",B=d(y({[k]:m()}),e=>({[k]:e}));function _(e,r,t){const s=r.reduce((n,u)=>n?.[u],e);if(typeof s!="function")throw new Error(`Topics did not resolve to a function: [${r.join(",")}]`);return s.call(e,...t)}function J(e){const r=new Map,t=s=>{if(O(s)){const n=H();return r.set(n,s.methods),B.create(n)}return s};return async(s,n)=>{const u=s[0];if(u&&u.startsWith($)){const o=r.get(u);if(!o)throw new Error(`Unknown namespace: ${u}`);const i=await _(o,s.slice(1),n);return t(i)}const a=await _(e,s,n);return t(a)}}var Z="RPC-TRANSFER";function ee(e){return!!e&&typeof e=="object"&&Z in e}function re(e){const r=[],t=n=>{if(ee(n))return r.push(n),n;if(Array.isArray(n))return n.map(t);if(n&&typeof n=="object"&&n.constructor===Object){const u={};for(const a in n)u[a]=t(n[a]);return u}return n};return{args:e.map(t),transferables:r}}function te(e){return typeof e=="object"&&typeof e?.postMessage=="function"&&typeof e?.closed=="boolean"}function ne(e){return te(e)?(r,t)=>e.postMessage(r,"*",t):(r,t)=>e.postMessage(r,t)}function se(e,{to:r=self,signal:t}={}){const s=ne(r),n=J(e);r.addEventListener("message",async u=>{const a=u.data;if(K.validate(a))try{if(z.validate(a.payload)){const o=await n(a.payload.topics,a.payload.args),{args:[i],transferables:c}=re([o]);s(W.create(a,i),c)}}catch(o){console.error("Error while processing rpc request:",o,a.payload),s(V.create(a,o))}},{signal:t}),"start"in r&&r.start?.()}const j={greet(e){return`Hello, ${e}!`},add(e,r){return e+r},multiply(e,r){return e*r},async fetchData(e){return await new Promise(r=>setTimeout(r,500)),{url:e,timestamp:Date.now(),data:"Fetched data from worker"}},math:{square(e){return e*e},factorial(e){return e<=1?1:e*j.math.factorial(e-1)}},slowOperation(e){return new Promise(r=>{setTimeout(()=>r(`Completed after ${e}ms`),e)})}};se(j);
